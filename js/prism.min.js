var Prism=Prism||{};Function.prototype.inherits=function(t){this.prototype=Object.create(t.prototype)},Prism.Utils=Prism.Utils||{},Prism.Helper={createChart:function(t){return new t.type(t)},createWidget:function(t){return new t.type(t)},oderTestById:function(t,a){return parseInt(t.test_id)>parseInt(a.test_id)?-1:parseInt(t.test_id)<parseInt(a.test_id)?1:0},delegateEvent:function(t,a){return function(e){e.stopPropagation();var r=e.target;do if(t(r))return e.delegateTarget=r,void a.apply(this,arguments);while(r=r.parentNode)}}},Prism.Utils.Tooltip=function(t){this.parent="undefined"!=typeof t.parent?t.parent:null,this.container="undefined"!=typeof t.container?t.container:null,this.tipHeader="undefined"!=typeof t.tipHeader?t.tipHeader:null,this.shown=!1,this.render(),this.atachEvents()},Prism.Utils.Tooltip.prototype={getInfo:function(t){return t.getAttribute("data-data")?this.data=JSON.parse(t.getAttribute("data-data")):console.log("No data for TT found"),this.data},getPosition:function(t){return t.getAttribute("data-x")?(this.x=JSON.parse(t.getAttribute("data-x")),this.y=JSON.parse(t.getAttribute("data-y"))):console.log("No data for TT found"),[this.x,this.y]},renderInfo:function(){var t=this;this.data&&(t.toolData=t.tooltip.selectAll("div").data(t.data),t.toolData.enter().append("div").attr("class","pris-tt-row").attr("data-fill",function(t){return t.fill}),t.toolData.html(""),t.toolData.append("span").attr("class","pris-tt-label").text(function(t){return t.label}),t.toolData.append("span").attr("class","pris-tt-value").text(function(t){return t.value}),t.toolData.append("span").attr("class","pris-tt-swatch").attr("style",function(t){return"background: "+t.fill+";"}),t.toolData.exit().remove())},setPossition:function(t,a){var e=this;e.tooltip.style("transform",function(e){return"translate("+t+"px,"+a+"px)"})},render:function(){var t=this;t.tooltip=d3.select(t.container).append("div").attr("class","pris-tt").style("position","absolute").style("pointer-events","none").style("display","none"),t.tooltip.append("span").attr("class","pris-tt-head").text(t.tipHeader)},atachEvents:function(){var t=this,a=function(t){return t.classList&&t.classList.contains("data-node")};t.container.addEventListener("mouseover",Prism.Helper.delegateEvent(a,function(){t.getInfo(event.target),t.renderInfo(),t.getPosition(event.target),t.setPossition(t.x,t.y),t.tooltip.style("display","block")})),t.container.addEventListener("mouseout",Prism.Helper.delegateEvent(a,function(){t.getInfo(event.target),t.renderInfo(),t.tooltip.style("display","none")}))}},Prism.Chart=Prism.Chart||{},Prism.Chart.Base=function(t){this.width="number"==typeof t.width?t.width:240,this.height="number"==typeof t.height?t.height:this.width,this.bottomPadding="number"==typeof t.bottomPadding?t.bottomPadding:0,this.container="undefined"!=typeof t.container?t.container:null,this.margin="number"==typeof t.margin?t.margin:20,this.dataSet="undefined"!=typeof t.dataSet?t.dataSet:null,this.data="undefined"!=typeof t.data?t.data:this.dataSet[0]},Prism.Chart.Base.prototype={render:function(){var t=this;d3.select(t.container).html(""),t.createGraph(),t.createControls(),t.draw(),t.createTooltip()},createTooltip:function(){var t=this;t.tooltip=new Prism.Utils.Tooltip({parent:t,container:t.container,tipHeader:"Info: "})},createGraph:function(){var t=this;d3.select(t.container).html(""),t.title=d3.select(t.container).append("h3").attr("class","pris-chart-header").text(t.data.label),t.graph=d3.select(t.container).append("svg:svg").attr("class","pris-chart").style("width",t.width+2*t.margin).attr("viewBox",function(){var a=t.height+2*t.margin+t.bottomPadding,e=t.width+2*t.margin;return"0,0,"+e+","+a}).append("g").attr("transform","translate("+t.margin+","+t.margin+")")},createControls:function(){var t=this;t.buttons=d3.select(t.container).append("div").attr("class","pris-button-set")},update:function(){var t=this;t.title.text(t.data.label),t.updateAxis(),t.draw()}},Prism.Chart.Axis=function(t){Prism.Chart.Base.apply(this,arguments),this.showX="boolean"==typeof t.showX?t.showX:!0,this.showY="boolean"==typeof t.showY?t.showY:!0,this.bottomPaddingSet="number"==typeof t.bottomPadding?t.bottomPadding:20,this.bottomPadding=this.showX?this.bottomPaddingSet:0,this.ySpacing=this.showY?30:0},Prism.Chart.Axis.inherits(Prism.Chart.Base),Prism.Chart.Axis.prototype.render=function(){var t=this;d3.select(t.container).html(""),t.createGraph(),t.createAxis(),t.createControls(),t.draw(),t.createTooltip()},Prism.Chart.Axis.prototype.scaleGraph=function(){var t=this;t.x=d3.scale.ordinal().rangeRoundBands([0,t.width-t.ySpacing],.1),t.y=d3.scale.linear().range([t.height,0]),t.yAxis=d3.svg.axis().scale(t.y).orient("left").ticks(4),t.xAxis=d3.svg.axis().scale(t.x).orient("bottom"),t.x.domain(t.data.data.map(function(t){return t.label})),t.y.domain([0,d3.max(t.data.data,function(t){return t.value})]),t.y.nice()},Prism.Chart.Axis.prototype.createAxis=function(){var t=this;t.scaleGraph(),t.showY&&t.graph.append("g").attr("class","y pris-axis").attr("transform","translate(20,0)").call(t.yAxis),t.showX&&t.graph.append("g").attr("class","x pris-axis").attr("transform",function(){return"translate("+t.ySpacing+","+t.height+")"}).call(t.xAxis).selectAll("text")},Prism.Chart.Axis.prototype.updateAxis=function(){var t=this;t.scaleGraph(),t.showY&&t.graph.transition().select(".y.pris-axis").duration(800).call(t.yAxis),t.showX&&t.graph.select(".x.pris-axis").call(t.xAxis).selectAll("text")},Prism.Chart.Barchart=function(t){Prism.Chart.Axis.apply(this,arguments),this.barSpacing="number"==typeof t.barSpacing?t.barSpacing:5,this.render()},Prism.Chart.Barchart.inherits(Prism.Chart.Axis),Prism.Chart.Barchart.prototype.draw=function(){var t=this;t.drawBars()},Prism.Chart.Barchart.prototype.drawBars=function(){var t=this;t.bars=t.graph.selectAll("rect").data(t.data.data),t.bars.enter().append("rect").attr("class","pris-bar data-node"),t.bars.attr("data-data",function(t){return t.data?JSON.stringify(t.data):JSON.stringify([t])}).style("transform",function(a){return"translateY("+t.height+"px)"}).attr("data-y",function(a){return t.y(a.value)+t.margin}).attr("data-x",function(a){return t.x(a.label)+t.ySpacing+t.x.rangeBand()+t.margin+10}).attr("height",0).attr("width",t.x.rangeBand()).attr("x",function(a){return t.x(a.label)+t.ySpacing}),t.bars.exit().remove(),setTimeout(function(){t.bars.style("transform",function(a){return"translateY("+t.y(a.value)+"px)"}).attr("height",function(a){return t.height-t.y(a.value)})},1)},Prism.Chart.BarchartMulti=function(t){Prism.Chart.Axis.apply(this,arguments),this.index=0,this.render(),this.attachEvents()},Prism.Chart.BarchartMulti.inherits(Prism.Chart.Barchart),Prism.Chart.BarchartMulti.prototype.draw=function(){var t=this;t.drawControls(),t.drawBars()},Prism.Chart.BarchartMulti.prototype.drawControls=function(){var t=this;t.selects=t.buttons.selectAll("button").data(Object.keys(t.dataSet)),t.selects.enter().append("button").text(function(a){return t.dataSet[a].label}).attr("data-obj",function(t){return t}),t.selects.attr("class",function(a){return a==t.index?"button select active":"button select"}),t.selects.exit().remove()},Prism.Chart.BarchartMulti.prototype.attachEvents=function(){var t=this,a=function(t){return t.classList&&t.classList.contains("select")};t.container.addEventListener("click",Prism.Helper.delegateEvent(a,function(){var a=event.target.getAttribute("data-obj");t.index=a,t.data=t.dataSet[a],t.update()}))},Prism.Chart.CompoundBarchart=function(t){Prism.Chart.Axis.apply(this,arguments),this.barSpacing="number"==typeof t.barSpacing?t.barSpacing:5,this.verticalSpacing="number"==typeof t.verticalSpacing?t.verticalSpacing:4,this.index=0,this.render()},Prism.Chart.CompoundBarchart.inherits(Prism.Chart.Barchart),Prism.Chart.CompoundBarchart.prototype.drawBars=function(){var t=this,a=0,e=0,r=0;t.bars=t.graph.selectAll("g.pris-bar-group").data(t.data.data),t.bars.enter().append("g").attr("class","pris-bar-group"),t.bars.style("transform",function(a){return"translateX("+(t.x(a.label)+t.ySpacing+t.barSpacing)+"px)"}),t.bars.sections=t.bars.selectAll("rect.pris-bar-section").data(function(t){return t.data}),t.bars.sections.enter().append("rect").attr("class","pris-bar-section"),t.bars.sections.style("transform",function(a){return"translateY("+t.height+"px)"}).attr("height",0).attr("width",t.x.rangeBand()-2*t.barSpacing),t.bars.sections.exit().remove(),t.bars.selectAll("rect.data-node").remove(),t.bars.append("rect").attr("class","data-node").attr("data-data",function(t){if(t.data){var a=t.data.slice(0);return a.reverse(),JSON.stringify(a)}}).attr("data-y",function(a){return t.y(a.value)+t.margin}).attr("data-x",function(a){return t.x(a.label)+t.ySpacing+t.x.rangeBand()+t.margin+10-t.barSpacing}).style("visibility","hidden").attr("width",function(a){return t.x.rangeBand()-2*t.barSpacing}).attr("height",function(a){return t.height}),setTimeout(function(){t.bars.sections.style("transform",function(i){var n=t.y(i.value)-r,s=t.data.data;r+=t.height-t.y(i.value);var o=s[a].data.length;return o-1>e?e+=1:(a+=1,e=0,r=0),"translateY("+n+"px)"}).attr("height",function(a){return t.height-t.y(a.value)-t.verticalSpacing}).attr("fill",function(t){return t.fill})},1),t.bars.exit().remove()},Prism.Chart.Piechart=function(t){Prism.Chart.Base.apply(this,arguments),this.spacing="number"==typeof t.spacing?t.spacing:.02,this.radius=Math.min(this.width,this.height)/2,this.render()},Prism.Chart.Piechart.inherits(Prism.Chart.Base),Prism.Chart.Piechart.prototype.draw=function(){var t=this;t.drawSections()},Prism.Chart.Piechart.prototype.drawSections=function(){var t=this,a=d3.svg.arc().outerRadius(t.radius),e=d3.layout.pie().value(function(t){return t.value}).sort(null),r=t.graph.append("g").attr("class","pris-piechart").attr("transform","translate("+t.width/2+","+t.height/2+")");t.sections=r.selectAll("path").data(e(t.data.data)).enter().append("path").attr("class","pris-pie-section data-node").attr("fill",function(t){return t.data.fill}).attr("d",a).attr("data-data",function(t){return t.data.data?JSON.stringify(t.data.data):JSON.stringify([t.data])})},Prism.Chart.Dougnutchart=function(t){Prism.Chart.Base.apply(this,arguments),this.spacing="number"==typeof t.spacing?t.spacing:.02,this.radius=Math.min(this.width,this.height)/2,this.innerRadius="number"==typeof t.innerRadius?t.innerRadius:100,this.render(),this.attachEvents()},Prism.Chart.Dougnutchart.inherits(Prism.Chart.Base),Prism.Chart.Dougnutchart.prototype.draw=function(){var t=this;t.drawSections()},Prism.Chart.Dougnutchart.prototype.drawSections=function(){var t=this,a=d3.svg.arc().innerRadius(t.radius-t.innerRadius).outerRadius(t.radius),e=d3.layout.pie().value(function(t){return t.value}).sort(null).padAngle(t.spacing),r=t.graph.append("g").attr("class","pris-dougnutchart").attr("transform","translate("+t.width/2+","+t.height/2+")");t.sections=r.selectAll("path").data(e(t.data.data)).enter().append("path").attr("class","pris-pie-section data-node pris-link").attr("d",a).attr("fill",function(t){return t.data.fill}).attr("data-data",function(t){return t.data.data?JSON.stringify(t.data.data):JSON.stringify([t.data])}).attr("data-x",function(e){var r=a.centroid(e);return r[0]+t.width/2}).attr("data-link",function(t){return t.data.label+".html"}).attr("data-y",function(e){var r=a.centroid(e);return r[1]+t.height/2})},Prism.Chart.Dougnutchart.prototype.attachEvents=function(){var t=this,a=function(t){return t.classList&&t.classList.contains("pris-link")};t.container.addEventListener("click",Prism.Helper.delegateEvent(a,function(){var t=event.target.getAttribute("data-link");alert("Redirect to: "+t)}))},Prism.Widget=Prism.Widget||{},Prism.Widget.Base=function(t){this.container="undefined"!=typeof t.container?t.container:null,this.data="undefined"!=typeof t.data?t.data:null},Prism.Widget.Base.prototype={},Prism.Widget.TestList=function(t){Prism.Widget.Base.apply(this,arguments),this.filters=new Array,this.currentData="undefined"!=typeof t.currentData?t.currentData:this.data,this.render()},Prism.Widget.TestList.inherits(Prism.Widget.Base),Prism.Widget.TestList.prototype.render=function(){var t=this;d3.select(t.container).html(""),t.filterData(),t.draw()},Prism.Widget.TestList.prototype.addFilters=function(t){var a=this;t&&a.filters.push(t)},Prism.Widget.TestList.prototype.filterData=function(t){var a=this;t&&a.addFilters(t),a.currentData=new Array;var e=a.data.filter(function(t){var e=!0;for(i=0;i<a.filters.length;i++)a.filters[i].value!=t[a.filters[i].property]&&(e=!1);return e});a.currentData=e.slice(0)},Prism.Widget.TestList.prototype.draw=function(){var t=this,a=d3.select(t.container).append("ul").attr("class","pd-test-list"),e=a.selectAll("li").data(t.currentData).enter().append("li").attr("class","pd-test-li");e.append("h4").attr("class","pd-test-li-heading").text(function(t){return t.type}),e.append("span").attr("class","pd-test-code").text("Kit No. ").append("span").text(function(t){return t.test_code}),e.append("span").attr("class","pd-test-status").text("Status: ").append("span").text(function(t){return t.status})},Prism.Page=Prism.Page||{},Prism.Page.Base=function(t){this.container="undefined"!=typeof t.container?t.container:null,this.data="undefined"!=typeof t.data?t.data:null},Prism.Page.Base.prototype={},Prism.Page.ResultsDash=function(t){Prism.Page.Base.apply(this,arguments),this.render(),this.attachEvents()},Prism.Page.ResultsDash.inherits(Prism.Page.Base),Prism.Page.ResultsDash.prototype.render=function(){},Prism.Page.ResultsDash.prototype.attachEvents=function(){var t=this;jQuery(t.container).on("click",".pd-edit",function(t){t.preventDefault(),t.stopPropagation(),jQuery(this.parentElement.parentElement).addClass("edit")}),jQuery(t.container).on("click",".pd-cancel",function(t){t.preventDefault(),t.stopPropagation(),jQuery(this.parentElement.parentElement).removeClass("edit")})},Prism.Page.SampleDash=function(t){Prism.Page.Base.apply(this,arguments),this.render(),this.attachEvents()},Prism.Page.SampleDash.inherits(Prism.Page.Base),Prism.Page.SampleDash.prototype.orderData=function(){var t=this;t.data[0]=new Array;for(var a in t.data)t.data.hasOwnProperty(a)&&(t.data[0]=t.data[0].concat(t.data[a]));for(var a in t.data)t.data.hasOwnProperty(a)&&t.data[a]&&t.data[a].sort(Prism.Helper.oderTestById)},Prism.Page.SampleDash.prototype.render=function(){var t=this;t.orderData(),t.chart=Prism.Helper.createWidget({type:Prism.Widget.TestList,container:document.getElementById("pd-test-data"),data:t.data[0]})},Prism.Page.SampleDash.prototype.attachEvents=function(){var t=this;jQuery(t.container).on("click",".pd-header",function(){var a=this.parentElement.getAttribute("data-profile");jQuery(".profile-card").removeClass("active"),jQuery(".profile-card").removeClass("edit"),jQuery(this.parentElement).addClass("active"),t.chart.data=t.data[a],t.chart.render()})};